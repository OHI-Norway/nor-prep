---
title: "Sustainability"
author: "Sigrid Engen"
date: "17 april 2019"
output: html_document
---

# Sustainability index
## Protein retention rate - municipality level Northern-Norway

```{r global_options, include=FALSE}
knitr::opts_chunk$set(echo=TRUE,warning=FALSE, message=FALSE)
```

```{r libraries, results="hide"}
library(knitr)
library(dplyr)
library(ggplot2)
library(ggthemes)
```

```{r data}
akva<-read.table("raw/Akvadataut.csv", header=TRUE, sep=";") #load data
akva<-na.omit(akva)# remove NAs
prod<-select(akva, Kname, Yrs, Knr2017,Protein.retention.ratio, SustFoodProd)#subset variables  
head(prod)
write.csv(prod, "data/sustainability_mariculture.csv")
```
## Plot sustainable food production 
```{r plot sustainable production, message =FALSE}

#make new variable separating by county
maricul_bycounty <-prod %>%  
              mutate(county = case_when( 
                                     Knr2017 >= 1800 &  Knr2017 < 1900 ~ "Nordland", 
                                     Knr2017 >= 1900 &  Knr2017 < 2000 ~ "Troms", 
                                     Knr2017 >= 2000 ~ "Finnmark"))  

maricul_bycounty <- maricul_bycounty[-c(487),]#remove outlier - figure out what is wrong with this!

counties <- unique(maricul_bycounty$county)

breaks1 <- seq(1994, 2018, by = 4) # decide where to write label on x-labels
labels1 <- as.character(breaks1) 
labels1[!breaks1%%2==0]<- "" 

for(i in 1:length(counties)) # basically saying repeat code i= 1 Nordland, i=2 Troms+++
   { 
   cty <- counties[i] 
    
   df <- maricul_bycounty %>% # filters dataset for the county for the ith loop
     filter(county == cty) 
  

plot <- ggplot(maricul_bycounty)+ 
       geom_col(aes(x = Yrs, y = SustFoodProd), fill = "dodgerblue4")+ 
       facet_wrap(Kname  ~ .) + 
       scale_x_continuous(breaks = breaks1, labels = labels1)+ 
       labs(y = "Sustainable Mariculture prod (tons)", x = "") + 
       theme_stata(scheme = "s1color") + 
       theme(legend.position = "none",  
           axis.text.x = element_text(size = 6, angle = 90, hjust = 1, vjust = 0.5, face = "bold"), 
             axis.text.y = element_text(size = 7, angle = 0), 
             #scale_y_discrete(breaks, c(""))
             plot.title = element_text(hjust=0.5, vjust=0.5), 
             axis.ticks.x = element_line(size = 0.5), 
             axis.ticks.length = unit(0.2, "cm"), 
             strip.text=element_text(size=8)) 
             
              
 ggsave(paste0("figs/sust_prod_", cty, ".png"), plot) 
    
 } 
    
 getwd()
```
## Plot protein retention rate
```{r plot protein retention}

for(i in 1:length(counties)) 
   { 
   cty <- counties[i] 
    
   df <- maricul_bycounty %>% 
     filter(county == cty) 
  
plot <- ggplot(maricul_bycounty)+ 
       geom_col(aes(x = Yrs, y = Protein.retention.ratio), fill = "dodgerblue4")+ 
       facet_wrap(Kname  ~ .) + 
      # scale_y_continuous(limits = c(0,10))+ 
       scale_x_continuous(breaks = breaks1, labels = labels1)+ 
       labs(y = "Protein retention rate", x = "") + 
       theme_stata(scheme = "s1color") + 
       theme(legend.position = "none",  
           axis.text.x = element_text(size = 6, angle = 90, hjust = 1, vjust = 0.5, face = "bold"), 
             axis.text.y = element_text(size = 7, angle = 0, face = "bold", margin = margin(t = 0, r = 5, b = 0, l = 0)), 
             plot.title = element_text(hjust=0.5, vjust=0.5), 
             axis.ticks.x = element_line(size = 0.5), 
             axis.ticks.length = unit(0.2, "cm"), 
             strip.text=element_text(size=8)) 

              
 ggsave(paste0("figs/protein_retention_", cty, ".png"), plot) 
    
 } 
```
# Map sustainable food production

```{r load admin data}

#load data needed

#setwd("C://Users//sigrid.engen//OneDrive - NINA//DATA//Kystbarometeret//Administrative data Norge")

#municNumber<-read.table("StudyMunicipalities.csv", header=TRUE, sep=";")

#head(municNumber)

#colnames(municNumber)<-c("MunicipalityNumber", "Municipality", "id")

Norway<-readOGR(dsn="C://Users//sigrid.engen//OneDrive - NINA//ArcGis//Kartdata kartverket//N2000-Kartdata-master//N2000-Kartdata-master", "NO_Fylker_pol")

#load municipalities shapefile 
municip<-readOGR(dsn="C://Users//sigrid.engen//OneDrive - NINA//ArcGis//Kartdata kartverket//N2000-Kartdata-master//N2000-Kartdata-master", "NO_Kommuner_pol")

plot(municip)

´´´